{% extends 'index.html' %} 
{% load static %}
{% block content %}
<section class="account-information pt-3">
    <h2 class="p-3">Account Information</h2>
    <form class="row g-3 w-75 mx-auto p-3 border rounded" method='POST' action="">
        {% csrf_token %}
        <div class="form-floating col-xl-6">
            {{ update_user_form.username }}
            <label for="usernameInput">Username</label>
        </div>
        <div class="form-floating col-xl-6">
            {{ update_user_form.email }}
            <label for="emailInput">Email</label>
        </div>
        <div class="form-floating col-xl-12">
            {{ update_customer_form.first_name }}
            <label for="first_nameInput">First Name</label>
        </div>
        <div class="form-floating col-xl-12">
            {{ update_customer_form.last_name }}
            <label for="last_nameInput">Last Name</label>
        </div>
        <div class="form-floating col-xl-12">
            {{ update_customer_form.street }}
            <label for="streetInput">Street</label>
        </div>
        <div class="form-floating col-xl-5">
            {{ update_customer_form.city }}
            <label for="cityInput">City</label>
        </div>
        <div class="form-floating col-xl-5">
            {{ update_customer_form.state }}
            <label for="stateInput">State</label>
        </div>
        <div class="form-floating col-xl-2">
            {{ update_customer_form.zip_code }}
            <label for="zip_codeInput">Zip Code</label>
        </div>
    
        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-lg btn-success">Update Information</button>
            {% for message in messages %}
            <div class="alert alert-warning col-xl-12 mx-auto">{{ message }}</div>
            {% endfor %}
            
            {% if update_user_form.errors %}
                {% for field in update_user_form %}
                    {% for error in field.errors %}
                        <div class="alert alert-danger col-xl-12 mx-auto" role="alert"><strong>{{ error|escape }}</strong></div>
                    {% endfor %}
                {% endfor %}
                {% for error in update_user_form.non_field_errors %}
                    <div class="alert alert-danger col-xl-12 mx-auto" role="alert"><strong>{{ error|escape }}</strong></div>
                {% endfor %}
            {% endif %}

            {% if update_customer_form.errors %}
                {% for field in update_customer_form %}
                    {% for error in field.errors %}
                        <div class="alert alert-danger col-xl-12 mx-auto" role="alert"><strong>{{ error|escape }}</strong></div>
                    {% endfor %}
                {% endfor %}
                {% for error in update_customer_form.non_field_errors %}
                    <div class="alert alert-danger col-xl-12 mx-auto" role="alert"><strong>{{ error|escape }}</strong></div>
                {% endfor %}
            {% endif %}
        </div>
    </form>
</section>

<section class="saved-presets pt-3">
    <h2 class="p-3">Saved Presets</h2>
    <div class="row">
        {% for configuration in configurations %}
        <div class="col-md-8 col-lg-4 my-2">
            {% include 'base/account/account-page/saved-preset-card.html' %}
        </div>
        {% endfor %}
    </div>
</section>

{% if completed_orders %}
<section class="order-history py-3">
    <h2>Order History</h2>

    {% for completed_order in completed_orders %}
        <div class="card text-center my-5 w-75 mx-auto">
            <div class="card-header">
                Order placed {{completed_order.date_ordered}}
            </div>

            <div class="card-body">
                <div class="accordion" id="accordion-{{order_item.id}}">
                {% for order_item in completed_order.configurations.all %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="heading-{{order_item.id}}">
                            <button class="accordion-button collapsed btn-dark" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{order_item.id}}" aria-expanded="true" aria-controls="collapse-{{order_item.id}}">
                                <div class="d-flex justify-content-between align-items-center">
                                    <img src="{% static order_item.configuration.configuration_items.all.0.image_url %}" alt="Selected guitar shape" class="w-25">
                                    <div class="d-flex gap-4">
                                        <div class="fw-bold">{{ order_item.configuration.name }}</div>
                                        <div>x{{ order_item.quantity }}</div>
                                        <div class="fw-bold fst-italic text-success">€{{ order_item.total_price }}</div>
                                    </div>
                                </div>
                            </button>
                        </h2>
                        <div class="accordion-collapse collapse" id="collapse-{{order_item.id}}" aria-labelledby="heading-{{order_item.id}}" data-bs-parent="#accordion-{{order_item.id}}">
                            <div class="accordion-body bg-dark">
                                <div class="table-responsive">
                                    <table class="table table-dark table-striped">
                                        <thead>
                                            <tr>
                                                <th scope="col">Category</th>
                                                <th scope="col">Selected Item</th>
                                                <th scope="col">Price</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for configuration_item in order_item.configuration.configuration_items.all %}
                                                <tr>
                                                    <td>{{ configuration_item.category.name }}</td>
                                                    <td>{{ configuration_item }}</td>
                                                    <td>€{{ configuration_item.price }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                </div>
            </div>

            <div class="card-footer">
                Total price: 
                <span class="fw-bold p-2">€{{completed_order.total_price}}</span>
            </div>
        </div>
    {% endfor %}
</section>
{% endif %}
{% endblock content %}
